# APS ì»¨ì„¤íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ - ì „ì²´ êµ¬ì¡° ì„¤ëª…

> **ë¹„ì „ê³µìë„ ì´í•´í•  ìˆ˜ ìˆëŠ” ì‹œìŠ¤í…œ ë™ì‘ ì›ë¦¬ ê°€ì´ë“œ**

ì´ ë¬¸ì„œëŠ” APS ì»¨ì„¤íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œì´ ì–´ë–»ê²Œ ì‘ë™í•˜ëŠ”ì§€ë¥¼ ì‰½ê²Œ ì„¤ëª…í•©ë‹ˆë‹¤.
í”„ë¡œê·¸ë˜ë°ì„ ëª¨ë¥´ëŠ” ë¶„ë“¤ë„ "ì „ì²´ íë¦„"ì„ ì´í•´í•  ìˆ˜ ìˆë„ë¡ ì‘ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

---

## ğŸ“‹ ëª©ì°¨

1. [ì‹œìŠ¤í…œ ê°œìš”](#1-ì‹œìŠ¤í…œ-ê°œìš”)
2. [ì „ì²´ êµ¬ì¡° í•œëˆˆì— ë³´ê¸°](#2-ì „ì²´-êµ¬ì¡°-í•œëˆˆì—-ë³´ê¸°)
3. [ê° ë¶€ë¶„ ìƒì„¸ ì„¤ëª…](#3-ê°-ë¶€ë¶„-ìƒì„¸-ì„¤ëª…)
4. [ì‹¤ì œ ì‚¬ìš© íë¦„](#4-ì‹¤ì œ-ì‚¬ìš©-íë¦„)
5. [ë°ì´í„° ì €ì¥ ë°©ì‹](#5-ë°ì´í„°-ì €ì¥-ë°©ì‹)
6. [ë³´ì•ˆ ë° ì ‘ê·¼ ì œì–´](#6-ë³´ì•ˆ-ë°-ì ‘ê·¼-ì œì–´)
7. [ìë™í™” ê¸°ëŠ¥](#7-ìë™í™”-ê¸°ëŠ¥)
8. [ë¹„ìš© êµ¬ì¡°](#8-ë¹„ìš©-êµ¬ì¡°)

---

## 1. ì‹œìŠ¤í…œ ê°œìš”

### ğŸ¯ ì´ ì‹œìŠ¤í…œì´ í•˜ëŠ” ì¼

**APS ì»¨ì„¤íŒ… ê´€ë¦¬ ì‹œìŠ¤í…œ**ì€ 3ê°€ì§€ ì£¼ìš” ê¸°ëŠ¥ì„ ì œê³µí•©ë‹ˆë‹¤:

1. **ê³ ê° ìƒë‹´ ì ‘ìˆ˜** - ì›¹ì‚¬ì´íŠ¸ì—ì„œ ê³ ê°ì´ ë¬¸ì˜ë¥¼ ë‚¨ê¸°ë©´ ìë™ìœ¼ë¡œ ì €ì¥
2. **ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ** - ì§ì›ë“¤ì´ ë¡œê·¸ì¸í•´ì„œ ë¬¸ì˜ ëª©ë¡ í™•ì¸ ë° ê´€ë¦¬
3. **ìë™ SMS ë°œì†¡** - "ë¬¸ì˜ í™•ì¸" ë²„íŠ¼ í´ë¦­ ì‹œ ê³ ê°ì—ê²Œ ìë™ìœ¼ë¡œ ë¬¸ì ë°œì†¡

### ğŸ¢ ì‹œìŠ¤í…œ êµ¬ì„±

ì´ ì‹œìŠ¤í…œì€ **4ê°œì˜ ë…ë¦½ì ì¸ ë¶€ë¶„**ìœ¼ë¡œ êµ¬ì„±ë˜ì–´ ìˆìŠµë‹ˆë‹¤:

| ì´ë¦„ | ì—­í•  | ìœ„ì¹˜ |
|------|------|------|
| **Frontend (í”„ë¡ íŠ¸ì—”ë“œ)** | ê´€ë¦¬ìê°€ ë³´ëŠ” í™”ë©´ | GitHub Pages |
| **GCP (ê³µê°œ API)** | ê³ ê°ì´ ë¬¸ì˜ë¥¼ ì œì¶œí•˜ëŠ” ì…êµ¬ | Google Cloud Run |
| **GCP2 (ë°±ì—”ë“œ API)** | ê´€ë¦¬ìì™€ ë°ì´í„°ë¥¼ ì—°ê²°í•˜ëŠ” ì¤‘ê°„ ë‹¤ë¦¬ | Google Cloud Run |
| **GCP3 (SMS ì¤‘ê³„)** | ë¬¸ì ë©”ì‹œì§€ ë°œì†¡ ì „ìš© ì„œë²„ | Google Compute Engine |
| **GCP-cleanup (ìë™ ì‚­ì œ)** | ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì‚­ì œ | Cloud Function |

---

## 2. ì „ì²´ êµ¬ì¡° í•œëˆˆì— ë³´ê¸°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          ğŸŒ ì¸í„°ë„·                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                        â”‚
        â”‚                                        â”‚
   â”Œâ”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”                          â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
   â”‚  ê³ ê°      â”‚                          â”‚  ê´€ë¦¬ì    â”‚
   â”‚  (ë°©ë¬¸ì)  â”‚                          â”‚  (ì§ì›)    â”‚
   â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜                          â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
        â”‚                                        â”‚
        â”‚ â‘  ìƒë‹´ ì‹ ì²­                           â”‚ â‘¡ ë¡œê·¸ì¸
        â”‚    (ì´ë¦„, ì „í™”ë²ˆí˜¸, ë¬¸ì˜ ë‚´ìš© ì…ë ¥)   â”‚    (Google/Naver ê³„ì •)
        â”‚                                        â”‚
        â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   GCP (ê³µê°œ API)   â”‚                  â”‚  Frontend (í™”ë©´)     â”‚
â”‚   Cloud Run       â”‚                  â”‚  GitHub Pages       â”‚
â”‚                   â”‚                  â”‚                     â”‚
â”‚ â€¢ ë¬¸ì˜ ì ‘ìˆ˜       â”‚                  â”‚ â€¢ ë¡œê·¸ì¸ í™”ë©´       â”‚
â”‚ â€¢ reCAPTCHA ê²€ì¦  â”‚                  â”‚ â€¢ ë¬¸ì˜ ëª©ë¡ í™”ë©´    â”‚
â”‚ â€¢ ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ â”‚                  â”‚ â€¢ ë¬¸ì˜ ìƒì„¸ ë³´ê¸°    â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                        â”‚
      â”‚ â‘¢ Firestoreì— ì €ì¥                    â”‚ â‘£ API í˜¸ì¶œ
      â”‚                                        â”‚
      â–¼                                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ğŸ’¾ Firestore (ë°ì´í„°ë² ì´ìŠ¤)                  â”‚
â”‚                                                          â”‚
â”‚  ì €ì¥ ë‚´ìš©:                                              â”‚
â”‚  - ê³ ê° ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼                           â”‚
â”‚  - ë¬¸ì˜ ìœ í˜• (ë¹„ì/ë¹„ì˜ë¦¬/ê¸°ì—…ì¸í—ˆê°€/ë¯¼ì›í–‰ì •)           â”‚
â”‚  - ë¬¸ì˜ ë‚´ìš©                                             â”‚
â”‚  - ì²¨ë¶€íŒŒì¼ (ìˆëŠ” ê²½ìš°)                                  â”‚
â”‚  - ì ‘ìˆ˜ ì‹œê°„                                             â”‚
â”‚  - í™•ì¸ ì—¬ë¶€ (check: true/false)                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â‘¤ ë°ì´í„° ì¡°íšŒ/ìˆ˜ì •
                   â”‚
                   â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  GCP2 (ë°±ì—”ë“œ API)â”‚
         â”‚  Cloud Run        â”‚
         â”‚                   â”‚
         â”‚ â€¢ ì¸ì¦ í™•ì¸       â”‚
         â”‚ â€¢ ë¬¸ì˜ ëª©ë¡ ì œê³µ  â”‚
         â”‚ â€¢ ìƒíƒœ ì—…ë°ì´íŠ¸   â”‚
         â”‚ â€¢ SMS ë°œì†¡ ìš”ì²­   â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ â‘¥ SMS ë°œì†¡ ìš”ì²­
               â”‚    (í™•ì¸ ë²„íŠ¼ í´ë¦­ ì‹œ)
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  GCP3 (SMS ì¤‘ê³„)   â”‚
         â”‚  Compute Engine VMâ”‚
         â”‚  ê³ ì • IP          â”‚
         â”‚                   â”‚
         â”‚ â€¢ Aligo API í˜¸ì¶œ  â”‚
         â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â”‚ â‘¦ SMS ì „ì†¡
               â”‚
               â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  ğŸ“± Aligo SMS  â”‚
         â”‚  (ì•Œë¦¬ê³ )      â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                 â”‚
                 â”‚ â‘§ ê³ ê°ì—ê²Œ ë¬¸ì ë„ì°©
                 â”‚
                 â–¼
            [ ê³ ê° íœ´ëŒ€í° ]
            "ë¬¸ì˜ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤"


         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚  GCP-cleanup           â”‚
         â”‚  (ìë™ ì‚­ì œ ì‹œìŠ¤í…œ)     â”‚
         â”‚  Cloud Function        â”‚
         â”‚                        â”‚
         â”‚  â€¢ ë§¤ì¼ ìƒˆë²½ 2ì‹œ ì‹¤í–‰  â”‚
         â”‚  â€¢ 179ì¼ ì§€ë‚œ ë°ì´í„°   â”‚
         â”‚    ìë™ ì‚­ì œ           â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3. ê° ë¶€ë¶„ ìƒì„¸ ì„¤ëª…

### ğŸ–¥ï¸ Frontend (í”„ë¡ íŠ¸ì—”ë“œ) - ê´€ë¦¬ìê°€ ë³´ëŠ” í™”ë©´

**ìœ„ì¹˜:** https://admin.apsconsulting.kr
**ê¸°ìˆ :** React (JavaScript í”„ë ˆì„ì›Œí¬)
**í˜¸ìŠ¤íŒ…:** GitHub Pages

#### ğŸ”‘ ì£¼ìš” ê¸°ëŠ¥

1. **ë¡œê·¸ì¸ í™”ë©´**
   - Google ê³„ì • ë˜ëŠ” Naver ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
   - í—ˆê°€ëœ ì´ë©”ì¼ë§Œ ì ‘ê·¼ ê°€ëŠ¥ (ë°±ì—”ë“œì—ì„œ ê²€ì¦)

2. **ë¬¸ì˜ ëª©ë¡ í™”ë©´**
   - ëª¨ë“  ë¬¸ì˜ë¥¼ í‘œ í˜•íƒœë¡œ í‘œì‹œ
   - ê²€ìƒ‰ ê¸°ëŠ¥ (ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼)
   - í•„í„° ê¸°ëŠ¥ (ë¯¸í™•ì¸ë§Œ ë³´ê¸°, ìœ í˜•ë³„ í•„í„°)
   - í˜ì´ì§€ë„¤ì´ì…˜ (10ê°œì”© í‘œì‹œ)

3. **ë¬¸ì˜ ìƒì„¸ ë³´ê¸° (ëª¨ë‹¬)**
   - ê³ ê° ì •ë³´ ì „ì²´ í™•ì¸
   - ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ
   - "í™•ì¸ ì™„ë£Œ" ë²„íŠ¼ â†’ SMS ìë™ ë°œì†¡

4. **ì¼ê´„ ì‘ì—…**
   - ì—¬ëŸ¬ ë¬¸ì˜ ì„ íƒí•´ì„œ í•œ ë²ˆì— í™•ì¸ ì²˜ë¦¬
   - ì—¬ëŸ¬ ë¬¸ì˜ ì„ íƒí•´ì„œ í•œ ë²ˆì— ì‚­ì œ

#### ğŸ“‚ íŒŒì¼ êµ¬ì¡°

```
src/
â”œâ”€â”€ App.jsx                    # ë©”ì¸ ì•± (ì „ì²´ ìƒíƒœ ê´€ë¦¬)
â”œâ”€â”€ components/                # í™”ë©´ êµ¬ì„± ìš”ì†Œ
â”‚   â”œâ”€â”€ LoginPage.jsx         # ë¡œê·¸ì¸ í™”ë©´
â”‚   â”œâ”€â”€ Header.jsx            # ìƒë‹¨ í—¤ë”
â”‚   â”œâ”€â”€ SearchBar.jsx         # ê²€ìƒ‰ì°½
â”‚   â”œâ”€â”€ ConsultationTable.jsx # ë¬¸ì˜ ëª©ë¡ í‘œ
â”‚   â”œâ”€â”€ ConsultationModal.jsx # ìƒì„¸ ë³´ê¸° íŒì—…
â”‚   â”œâ”€â”€ ConfirmModal.jsx      # SMS ë°œì†¡ í™•ì¸ íŒì—…
â”‚   â”œâ”€â”€ AlertModal.jsx        # ì•Œë¦¼ íŒì—…
â”‚   â””â”€â”€ Pagination.jsx        # í˜ì´ì§€ ë²ˆí˜¸
â”œâ”€â”€ auth/                      # ë¡œê·¸ì¸ ê´€ë ¨
â”‚   â”œâ”€â”€ authManager.js        # Google/Naver í†µí•© ê´€ë¦¬
â”‚   â”œâ”€â”€ googleAuth.js         # Google OAuth
â”‚   â””â”€â”€ naverAuth.js          # Naver OAuth
â”œâ”€â”€ services/                  # API í†µì‹ 
â”‚   â”œâ”€â”€ inquiryService.js     # ë¬¸ì˜ ë°ì´í„° CRUD
â”‚   â””â”€â”€ smsService.js         # SMS ë°œì†¡
â””â”€â”€ config/
    â””â”€â”€ api.js                # API ì£¼ì†Œ ì„¤ì •
```

#### ğŸ”„ ë°ì´í„° íë¦„

```
ì‚¬ìš©ì ë¡œê·¸ì¸
  â†“
Google/Naverì—ì„œ Access Token ë°œê¸‰
  â†“
localStorageì— í† í° ì €ì¥
  â†“
GCP2 ë°±ì—”ë“œ APIì— í† í°ê³¼ í•¨ê»˜ ìš”ì²­
  â†“
ë°±ì—”ë“œì—ì„œ í† í° ê²€ì¦
  â†“
Firestoreì—ì„œ ë°ì´í„° ì¡°íšŒ
  â†“
í™”ë©´ì— í‘œì‹œ
```

---

### ğŸŒ GCP (ê³µê°œ API) - ê³ ê° ë¬¸ì˜ ì ‘ìˆ˜

**URL:** Cloud Run ìë™ ìƒì„± ì£¼ì†Œ
**ê¸°ìˆ :** Node.js + Express
**ì—­í• :** ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸ìê°€ ë¬¸ì˜ë¥¼ ì œì¶œí•˜ëŠ” ì…êµ¬

#### ğŸ”‘ ì£¼ìš” ê¸°ëŠ¥

1. **POST /contact** - ë¬¸ì˜ ì œì¶œ
   - ê³ ê°ì´ ìƒë‹´ ì‹ ì²­ í¼ ì‘ì„± â†’ ì´ APIë¡œ ì „ì†¡
   - reCAPTCHAë¡œ ë´‡/ìŠ¤íŒ¸ ì°¨ë‹¨
   - ì…ë ¥ê°’ ê²€ì¦ (ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼ í˜•ì‹ ë“±)
   - Firestoreì— ì €ì¥

2. **POST /uploadRequest** - ì²¨ë¶€íŒŒì¼ ì—…ë¡œë“œ
   - íŒŒì¼ ì—…ë¡œë“œë¥¼ ìœ„í•œ ì„œëª…ëœ URL ë°œê¸‰
   - Firebase Storageì— ì €ì¥

#### ğŸ›¡ï¸ ë³´ì•ˆ ê¸°ëŠ¥

```javascript
// 1. reCAPTCHA Enterprise ê²€ì¦
// â†’ Googleì´ ì œê³µí•˜ëŠ” ë´‡ ì°¨ë‹¨ ì‹œìŠ¤í…œ
// â†’ ì ìˆ˜ ê¸°ë°˜ (0.0~1.0, 0.5 ì´ìƒë§Œ í†µê³¼)

// 2. ì…ë ¥ê°’ ê²€ì¦
ì´ë¦„: 1~100ì
ì „í™”ë²ˆí˜¸: ìˆ«ì/í•˜ì´í”ˆë§Œ, 7~20ì
ì´ë©”ì¼: ì˜¬ë°”ë¥¸ ì´ë©”ì¼ í˜•ì‹
ë©”ì‹œì§€: 10~2000ì
ì²¨ë¶€íŒŒì¼: ìµœëŒ€ 5ê°œ

// 3. ì†ë„ ì œí•œ (Rate Limiting)
// â†’ ê°™ì€ IPì—ì„œ 1ë¶„ì— 10íšŒ ì´ìƒ ìš”ì²­ ì‹œ ì°¨ë‹¨

// 4. CORS (ë„ë©”ì¸ ì œí•œ)
// â†’ í—ˆê°€ëœ ë„ë©”ì¸ì—ì„œë§Œ API í˜¸ì¶œ ê°€ëŠ¥
```

#### ğŸ“Š ë°ì´í„° ì €ì¥ í˜•ì‹

```javascript
// Firestoreì— ì €ì¥ë˜ëŠ” ë¬¸ì„œ êµ¬ì¡°
{
  name: "í™ê¸¸ë™",
  phone: "010-1234-5678",
  email: "hong@example.com",
  category: "visa",  // visa, nonprofit, corporate, civil, etc
  nationality: "KOR",
  company: "APS ì£¼ì‹íšŒì‚¬",
  message: "E-2 ë¹„ì ì‹ ì²­ ê´€ë ¨ ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤...",
  attachments: [
    {
      name: "ì—¬ê¶Œì‚¬ë³¸.pdf",
      path: "inquiries/1234567890_abc123_ì—¬ê¶Œì‚¬ë³¸.pdf",
      type: "application/pdf",
      size: 245678
    }
  ],
  ip: "123.45.67.89",
  recaptchaScore: 0.9,
  createdAt: "2024-12-08T10:30:00Z",
  deleteAt: "2025-06-05T10:30:00Z",  // 179ì¼ í›„
  status: "new",
  check: false  // ê´€ë¦¬ì í™•ì¸ ì—¬ë¶€
}
```

---

### ğŸ”§ GCP2 (ë°±ì—”ë“œ API) - ê´€ë¦¬ì ì „ìš©

**URL:** https://inquiryapi-mbi34yrklq-uc.a.run.app
**ê¸°ìˆ :** Node.js 20 + Express
**ì—­í• :** ê´€ë¦¬ì í™”ë©´ê³¼ ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì—°ê²°í•˜ëŠ” ì¤‘ê°„ ë‹¤ë¦¬

#### ğŸ”‘ ì£¼ìš” ê¸°ëŠ¥

1. **ì¸ì¦ ì‹œìŠ¤í…œ**
   ```
   ê´€ë¦¬ì ë¡œê·¸ì¸ (Google/Naver)
     â†“
   Access Token ë°œê¸‰
     â†“
   ëª¨ë“  API ìš”ì²­ì— í† í° í¬í•¨
     â†“
   ë°±ì—”ë“œì—ì„œ í† í° ê²€ì¦
     â†“
   ì´ë©”ì¼ì´ í—ˆê°€ ëª©ë¡ì— ìˆëŠ”ì§€ í™•ì¸
     â†“
   í†µê³¼í•˜ë©´ ë°ì´í„° ì œê³µ
   ```

2. **ë¬¸ì˜ ê´€ë¦¬ API**

   | ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… |
   |-----------|--------|------|
   | `/inquiries` | GET | ë¬¸ì˜ ëª©ë¡ ì¡°íšŒ |
   | `/inquiries/:id` | GET | íŠ¹ì • ë¬¸ì˜ ìƒì„¸ ì¡°íšŒ |
   | `/inquiries/:id` | PATCH | ë¬¸ì˜ ìƒíƒœ ìˆ˜ì • (í™•ì¸ ì²˜ë¦¬) |
   | `/inquiries/:id` | DELETE | ë¬¸ì˜ ì‚­ì œ |
   | `/inquiries/:id/attachments/urls` | GET | ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ URL ë°œê¸‰ |

3. **SMS ë°œì†¡ API**

   | ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… |
   |-----------|--------|------|
   | `/sms/send` | POST | SMS ë°œì†¡ ìš”ì²­ |

4. **Naver OAuth í† í° êµí™˜**

   | ì—”ë“œí¬ì¸íŠ¸ | ë©”ì„œë“œ | ì„¤ëª… |
   |-----------|--------|------|
   | `/auth/naver/token` | POST | ì¸ê°€ ì½”ë“œë¥¼ ì•¡ì„¸ìŠ¤ í† í°ìœ¼ë¡œ êµí™˜ |

#### ğŸ” ë³´ì•ˆ ë° ì ‘ê·¼ ì œì–´

```javascript
// 1. ì´ë©”ì¼ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸
const ALLOWED_EMAILS = [
  "admin@apsconsulting.kr",
  "manager@apsconsulting.kr"
];

// 2. í† í° ê²€ì¦ í”„ë¡œì„¸ìŠ¤
async function authenticate(req, res, next) {
  // â‘  Authorization í—¤ë”ì—ì„œ í† í° ì¶”ì¶œ
  const token = req.headers.authorization.split("Bearer ")[1];
  const provider = req.headers['x-provider']; // google or naver

  // â‘¡ Google/Naver APIë¡œ í† í° ê²€ì¦
  if (provider === 'google') {
    // Google tokeninfo API í˜¸ì¶œ
    const tokenInfo = await fetch(
      `https://www.googleapis.com/oauth2/v3/tokeninfo?access_token=${token}`
    );
  } else if (provider === 'naver') {
    // Naver user info API í˜¸ì¶œ
    const userInfo = await fetch('https://openapi.naver.com/v1/nid/me', {
      headers: { Authorization: `Bearer ${token}` }
    });
  }

  // â‘¢ ì´ë©”ì¼ í™•ì¸
  if (!ALLOWED_EMAILS.includes(userEmail)) {
    return res.status(403).json({ error: "Access denied" });
  }

  // â‘£ í†µê³¼!
  next();
}
```

#### ğŸ“¤ SMS ë°œì†¡ íë¦„

```
ê´€ë¦¬ìê°€ "í™•ì¸ ì™„ë£Œ" ë²„íŠ¼ í´ë¦­
  â†“
Frontendì—ì„œ GCP2ë¡œ ìš”ì²­
  POST /sms/send
  {
    receiver: "010-1234-5678",
    msg: "[APS ì»¨ì„¤íŒ…]\ní™ê¸¸ë™ë‹˜ì˜ ë¬¸ì˜ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤.\në‹´ë‹¹ìê°€ ê³§ ì—°ë½ë“œë¦¬ê² ìŠµë‹ˆë‹¤."
  }
  â†“
GCP2ê°€ GCP3 (SMS ì¤‘ê³„ ì„œë²„)ë¡œ ì „ë‹¬
  POST http://136.113.67.193:3000/sms/send
  â†“
GCP3ê°€ Aligo APIë¡œ ìµœì¢… ì „ì†¡
  POST https://apis.aligo.in/send/
  â†“
ê³ ê° íœ´ëŒ€í°ì— ë¬¸ì ë„ì°©
```

---

### ğŸ“± GCP3 (SMS ì¤‘ê³„ ì„œë²„)

**ìœ„ì¹˜:** Google Compute Engine VM
**ê³ ì • IP:** 136.113.67.193
**í¬íŠ¸:** 3000
**ë¹„ìš©:** í”„ë¦¬í‹°ì–´ (ë¬´ë£Œ)

#### â“ ì™œ ë³„ë„ ì„œë²„ê°€ í•„ìš”í•œê°€?

**ë¬¸ì œ ìƒí™©:**
- Aligo SMS APIëŠ” "ê³ ì • IP ì£¼ì†Œ"ì—ì„œë§Œ ìš”ì²­ì„ ë°›ìŒ
- Cloud Run(GCP2)ì€ ìš”ì²­ë§ˆë‹¤ IPê°€ ë°”ë€œ
- ë”°ë¼ì„œ ì§ì ‘ Aligoë¥¼ í˜¸ì¶œí•  ìˆ˜ ì—†ìŒ

**í•´ê²° ë°©ë²•:**
- ê³ ì • IPë¥¼ ê°€ì§„ VMì„ ì¤‘ê°„ì— ë°°ì¹˜
- GCP2 â†’ GCP3 (ê³ ì • IP) â†’ Aligo

#### ğŸ”§ êµ¬ì¡°

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  GCP3 (VM)                          â”‚
â”‚  IP: 136.113.67.193                â”‚
â”‚                                     â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚  SMS Relay ì„œë²„              â”‚  â”‚
â”‚  â”‚  Node.js + Express           â”‚  â”‚
â”‚  â”‚  Port: 3000                  â”‚  â”‚
â”‚  â”‚                              â”‚  â”‚
â”‚  â”‚  POST /sms/send              â”‚  â”‚
â”‚  â”‚  â†’ Aligo APIë¡œ ì „ë‹¬          â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                     â”‚
â”‚  systemdë¡œ ìë™ ì¬ì‹œì‘              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### ğŸ“ ì½”ë“œ êµ¬ì¡°

```javascript
// GCP3/sms-relay/index.js

const express = require('express');
const app = express();

// SMS ì¤‘ê³„ ì—”ë“œí¬ì¸íŠ¸
app.post('/sms/send', async (req, res) => {
  const { key, user_id, sender, receiver, msg } = req.body;

  // Aligo APIë¡œ ì „ë‹¬
  const response = await fetch('https://apis.aligo.in/send/', {
    method: 'POST',
    body: new URLSearchParams({
      key, user_id, sender, receiver, msg
    })
  });

  const result = await response.json();
  res.json(result);
});

app.listen(3000, () => {
  console.log('SMS Relay Server running on port 3000');
});
```

#### ğŸš€ ë°°í¬ ë°©ì‹

```bash
# VMì— SSH ì ‘ì†
gcloud compute ssh aligo-proxy --zone=us-central1-a

# íŒŒì¼ ì—…ë¡œë“œ
cd ~/sms-relay
npm install

# systemd ì„œë¹„ìŠ¤ ë“±ë¡ (ìë™ ì‹œì‘)
sudo cp sms-relay.service /etc/systemd/system/
sudo systemctl enable sms-relay
sudo systemctl start sms-relay

# ìƒíƒœ í™•ì¸
sudo systemctl status sms-relay
```

---

### ğŸ—‘ï¸ GCP-cleanup (ìë™ ì‚­ì œ ì‹œìŠ¤í…œ)

**ì—­í• :** ê°œì¸ì •ë³´ë³´í˜¸ë²• ì¤€ìˆ˜ (179ì¼ í›„ ìë™ ì‚­ì œ)
**ì‹¤í–‰ ì‹œê°„:** ë§¤ì¼ ìƒˆë²½ 2ì‹œ
**ê¸°ìˆ :** Cloud Function + Cloud Scheduler

#### ğŸ“… ì‘ë™ ì›ë¦¬

```
ë§¤ì¼ ìƒˆë²½ 2ì‹œ
  â†“
Cloud Schedulerê°€ Cloud Function í˜¸ì¶œ
  â†“
Firestoreì—ì„œ ì¡°íšŒ:
  WHERE deleteAt < ì˜¤ëŠ˜
  LIMIT 500
  â†“
ê° ë¬¸ì„œë§ˆë‹¤:
  1. ì²¨ë¶€íŒŒì¼ ì‚­ì œ (Storage)
  2. ë¬¸ì„œ ì‚­ì œ (Firestore)
  â†“
ë¡œê·¸ ì¶œë ¥:
  "ì‚­ì œ ì™„ë£Œ: 3ê±´ (ì²¨ë¶€íŒŒì¼ 5ê°œ)"
```

#### ğŸ”§ ì½”ë“œ êµ¬ì¡°

```javascript
// GCP-cleanup/index.js

exports.deleteOldInquiries = async (req, res) => {
  const now = new Date();

  // 179ì¼ ì§€ë‚œ ë°ì´í„° ì¡°íšŒ
  const snapshot = await db.collection("inquiries")
    .where("deleteAt", "<", now)
    .limit(500)
    .get();

  let deletedCount = 0;
  let fileCount = 0;

  for (const doc of snapshot.docs) {
    const data = doc.data();

    // 1. ì²¨ë¶€íŒŒì¼ ì‚­ì œ
    if (data.attachments) {
      for (const file of data.attachments) {
        await bucket.file(file.path).delete({ ignoreNotFound: true });
        fileCount++;
      }
    }

    // 2. ë¬¸ì„œ ì‚­ì œ
    await doc.ref.delete();
    deletedCount++;
  }

  console.log(`ì‚­ì œ ì™„ë£Œ: ${deletedCount}ê±´ (ì²¨ë¶€íŒŒì¼ ${fileCount}ê°œ)`);
  res.json({ deleted: deletedCount, files: fileCount });
};
```

#### â° Scheduler ì„¤ì •

```bash
# ë§¤ì¼ ìƒˆë²½ 2ì‹œ (í•œêµ­ ì‹œê°„) ì‹¤í–‰
gcloud scheduler jobs create http delete-old-inquiries \
  --schedule="0 2 * * *" \
  --time-zone="Asia/Seoul" \
  --uri="https://us-central1-apsconsulting.cloudfunctions.net/deleteOldInquiries"
```

---

## 4. ì‹¤ì œ ì‚¬ìš© íë¦„

### ğŸ“ ì‹œë‚˜ë¦¬ì˜¤ 1: ê³ ê°ì´ ìƒë‹´ ì‹ ì²­

```
1. ê³ ê°ì´ APS ì›¹ì‚¬ì´íŠ¸ ë°©ë¬¸
   â†’ "ìƒë‹´ ì‹ ì²­" ë²„íŠ¼ í´ë¦­

2. ìƒë‹´ ì‹ ì²­ í¼ ì‘ì„±
   ì´ë¦„: í™ê¸¸ë™
   ì „í™”ë²ˆí˜¸: 010-1234-5678
   ì´ë©”ì¼: hong@example.com
   ìœ í˜•: ë¹„ì ìƒë‹´
   ë‚´ìš©: E-2 ë¹„ì ì‹ ì²­ ê´€ë ¨ ë¬¸ì˜ë“œë¦½ë‹ˆë‹¤.
   ì²¨ë¶€íŒŒì¼: ì—¬ê¶Œì‚¬ë³¸.pdf

3. "ì œì¶œ" ë²„íŠ¼ í´ë¦­
   â†“
   reCAPTCHA ìë™ ê²€ì¦ (ë´‡ ì°¨ë‹¨)
   â†“
   GCP (ê³µê°œ API)ë¡œ ì „ì†¡
   â†“
   ì…ë ¥ê°’ ê²€ì¦ (í˜•ì‹ í™•ì¸)
   â†“
   ì²¨ë¶€íŒŒì¼ Firebase Storageì— ì—…ë¡œë“œ
   â†“
   Firestoreì— ë¬¸ì„œ ìƒì„±
   {
     name: "í™ê¸¸ë™",
     phone: "010-1234-5678",
     check: false,  // ì•„ì§ ë¯¸í™•ì¸
     ...
   }
   â†“
   "ì œì¶œì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤" ë©”ì‹œì§€ í‘œì‹œ
```

---

### ğŸ‘¨â€ğŸ’¼ ì‹œë‚˜ë¦¬ì˜¤ 2: ê´€ë¦¬ìê°€ ë¬¸ì˜ í™•ì¸

```
1. ì§ì›ì´ https://admin.apsconsulting.kr ì ‘ì†
   â†“
   ë¡œê·¸ì¸ í™”ë©´ í‘œì‹œ

2. "Googleë¡œ ë¡œê·¸ì¸" ë²„íŠ¼ í´ë¦­
   â†“
   Google ë¡œê·¸ì¸ íŒì—… ì—´ë¦¼
   â†“
   admin@apsconsulting.kr ê³„ì •ìœ¼ë¡œ ë¡œê·¸ì¸
   â†“
   Access Token ë°œê¸‰
   â†“
   localStorageì— í† í° ì €ì¥

3. ë¬¸ì˜ ëª©ë¡ í™”ë©´ í‘œì‹œ
   â†“
   Frontendê°€ GCP2ì— ìš”ì²­:
   GET /inquiries
   Authorization: Bearer [í† í°]
   X-Provider: google
   â†“
   GCP2ê°€ í† í° ê²€ì¦:
   - Google tokeninfo API í˜¸ì¶œ
   - ì´ë©”ì¼ í™•ì¸ (admin@apsconsulting.kr)
   - í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ì— ìˆìŒ â†’ í†µê³¼
   â†“
   Firestoreì—ì„œ ë¬¸ì˜ ëª©ë¡ ì¡°íšŒ
   â†“
   GCP2ê°€ ë°ì´í„° ë°˜í™˜
   â†“
   í™”ë©´ì— í‘œ í˜•íƒœë¡œ í‘œì‹œ

4. "í™ê¸¸ë™" ë¬¸ì˜ í´ë¦­
   â†“
   ìƒì„¸ ë³´ê¸° ëª¨ë‹¬ ì—´ë¦¼
   â†“
   ì²¨ë¶€íŒŒì¼ ë‹¤ìš´ë¡œë“œ URL ìš”ì²­:
   GET /inquiries/[id]/attachments/urls
   â†“
   Firebase Storage ì„œëª…ëœ URL ë°œê¸‰ (1ì‹œê°„ ìœ íš¨)
   â†“
   "ë‹¤ìš´ë¡œë“œ" ë²„íŠ¼ í´ë¦­ ì‹œ íŒŒì¼ ë‹¤ìš´ë¡œë“œ

5. "í™•ì¸ ì™„ë£Œ" ë²„íŠ¼ í´ë¦­
   â†“
   SMS ë°œì†¡ í™•ì¸ ëª¨ë‹¬ í‘œì‹œ
   "í™ê¸¸ë™ë‹˜ì—ê²Œ í™•ì¸ ë¬¸ìë¥¼ ë°œì†¡í•˜ì‹œê² ìŠµë‹ˆê¹Œ?"
   â†“
   "ë°œì†¡" ë²„íŠ¼ í´ë¦­
   â†“
   â‘  Firestore ì—…ë°ì´íŠ¸:
      PATCH /inquiries/[id]
      { check: true }
   â†“
   â‘¡ SMS ë°œì†¡ ìš”ì²­:
      POST /sms/send
      {
        receiver: "010-1234-5678",
        msg: "[APS ì»¨ì„¤íŒ…]\ní™ê¸¸ë™ë‹˜ì˜ ë¬¸ì˜ê°€ í™•ì¸ë˜ì—ˆìŠµë‹ˆë‹¤..."
      }
   â†“
   GCP2 â†’ GCP3 (ê³ ì • IP) â†’ Aligo
   â†“
   ê³ ê° íœ´ëŒ€í°ì— ë¬¸ì ë„ì°©
   â†“
   "ë°œì†¡ ì™„ë£Œ" ì•Œë¦¼ í‘œì‹œ
```

---

## 5. ë°ì´í„° ì €ì¥ ë°©ì‹

### ğŸ’¾ Firestore (NoSQL ë°ì´í„°ë² ì´ìŠ¤)

**êµ¬ì¡°:**

```
apsconsulting (í”„ë¡œì íŠ¸)
  â””â”€â”€ inquiries (ì»¬ë ‰ì…˜)
        â”œâ”€â”€ doc_12345 (ë¬¸ì„œ)
        â”‚     â”œâ”€â”€ name: "í™ê¸¸ë™"
        â”‚     â”œâ”€â”€ phone: "010-1234-5678"
        â”‚     â”œâ”€â”€ email: "hong@example.com"
        â”‚     â”œâ”€â”€ category: "visa"
        â”‚     â”œâ”€â”€ message: "E-2 ë¹„ì..."
        â”‚     â”œâ”€â”€ check: false
        â”‚     â”œâ”€â”€ createdAt: 2024-12-08T10:30:00Z
        â”‚     â””â”€â”€ deleteAt: 2025-06-05T10:30:00Z
        â”‚
        â”œâ”€â”€ doc_12346 (ë¬¸ì„œ)
        â”‚     â”œâ”€â”€ name: "ê¹€ì˜í¬"
        â”‚     â””â”€â”€ ...
        â”‚
        â””â”€â”€ ...
```

### ğŸ“ Firebase Storage (íŒŒì¼ ì €ì¥ì†Œ)

**êµ¬ì¡°:**

```
aps-list.appspot.com (ë²„í‚·)
  â””â”€â”€ inquiries/
        â”œâ”€â”€ 1702028400000_abc123_ì—¬ê¶Œì‚¬ë³¸.pdf
        â”œâ”€â”€ 1702028500000_def456_ì‚¬ì—…ìë“±ë¡ì¦.jpg
        â””â”€â”€ ...
```

**íŒŒì¼ëª… ê·œì¹™:**
```
[íƒ€ì„ìŠ¤íƒ¬í”„]_[ëœë¤ë¬¸ìì—´]_[ì›ë³¸íŒŒì¼ëª…]

ì˜ˆ: 1702028400000_abc123_ì—¬ê¶Œì‚¬ë³¸.pdf
    â†‘ ì—…ë¡œë“œ ì‹œê°„  â†‘ ê³ ìœ ID  â†‘ ì›ë³¸ ì´ë¦„
```

---

## 6. ë³´ì•ˆ ë° ì ‘ê·¼ ì œì–´

### ğŸ”’ ë‹¤ì¸µ ë³´ì•ˆ ì‹œìŠ¤í…œ

#### 1ï¸âƒ£ **ê³ ê° ë¬¸ì˜ ì œì¶œ (GCP ê³µê°œ API)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 1: reCAPTCHA Enterprise  â”‚
â”‚  â†’ ë´‡/ìë™í™” ìŠ¤í¬ë¦½íŠ¸ ì°¨ë‹¨          â”‚
â”‚  â†’ ì ìˆ˜ 0.5 ì´ìƒë§Œ í†µê³¼             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 2: ì…ë ¥ê°’ ê²€ì¦            â”‚
â”‚  â†’ ì´ë¦„, ì „í™”ë²ˆí˜¸, ì´ë©”ì¼ í˜•ì‹ í™•ì¸  â”‚
â”‚  â†’ SQL ì¸ì ì…˜ ë°©ì§€                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 3: ì†ë„ ì œí•œ              â”‚
â”‚  â†’ IPë‹¹ 1ë¶„ì— 10íšŒ ì œí•œ             â”‚
â”‚  â†’ DDoS ê³µê²© ë°©ì–´                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 4: CORS ì •ì±…              â”‚
â”‚  â†’ í—ˆê°€ëœ ë„ë©”ì¸ë§Œ API í˜¸ì¶œ ê°€ëŠ¥    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### 2ï¸âƒ£ **ê´€ë¦¬ì ì ‘ê·¼ (GCP2 ë°±ì—”ë“œ API)**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 1: OAuth ì¸ì¦             â”‚
â”‚  â†’ Google/Naver ë¡œê·¸ì¸ í•„ìˆ˜         â”‚
â”‚  â†’ Access Token ë°œê¸‰                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 2: í† í° ê²€ì¦              â”‚
â”‚  â†’ Google/Naver APIë¡œ í† í° ìœ íš¨ì„± í™•ì¸â”‚
â”‚  â†’ ìœ„ì¡° í† í° ì°¨ë‹¨                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 3: ì´ë©”ì¼ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸     â”‚
â”‚  â†’ ALLOWED_EMAILSì— ë“±ë¡ëœ ê³„ì •ë§Œ   â”‚
â”‚  â†’ ì™¸ë¶€ì¸ ì ‘ê·¼ ì™„ì „ ì°¨ë‹¨             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ë³´ì•ˆ ê³„ì¸µ 4: HTTPS ì•”í˜¸í™”           â”‚
â”‚  â†’ ëª¨ë“  í†µì‹  SSL/TLS ì•”í˜¸í™”         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### ğŸ”‘ í—ˆê°€ëœ ì´ë©”ì¼ ê´€ë¦¬

**í˜„ì¬ ì„¤ì • (ì˜ˆì‹œ):**

```javascript
// GCP2 í™˜ê²½ë³€ìˆ˜
ALLOWED_EMAILS=admin@apsconsulting.kr,manager@apsconsulting.kr,infra.steve.01@gmail.com
```

**ì¶”ê°€ ë°©ë²•:**

```bash
# Cloud Run í™˜ê²½ë³€ìˆ˜ ì—…ë°ì´íŠ¸
gcloud run services update inquiryapi \
  --region=us-central1 \
  --update-env-vars ALLOWED_EMAILS="admin@apsconsulting.kr,ìƒˆì´ë©”ì¼@example.com"
```

---

## 7. ìë™í™” ê¸°ëŠ¥

### ğŸ¤– ìë™ìœ¼ë¡œ ì‹¤í–‰ë˜ëŠ” ì‘ì—…ë“¤

#### 1ï¸âƒ£ **SMS ìë™ ë°œì†¡**

**íŠ¸ë¦¬ê±°:** ê´€ë¦¬ìê°€ "í™•ì¸ ì™„ë£Œ" ë²„íŠ¼ í´ë¦­

**ìë™ ì‹¤í–‰:**
1. Firestoreì— `check: true` ì—…ë°ì´íŠ¸
2. SMS ë°œì†¡ (GCP3 ê²½ìœ )
3. ì„±ê³µ ì‹œ ì•Œë¦¼ í‘œì‹œ
4. ì‹¤íŒ¨ ì‹œ ìƒíƒœ ë¡¤ë°± + ì—ëŸ¬ ì•Œë¦¼

**ë°œì†¡ ì‹¤íŒ¨ ì‹œ ë™ì‘:**
```
SMS ë°œì†¡ ì‹¤íŒ¨
  â†“
check: falseë¡œ ë˜ëŒë¦¼
  â†“
"ë¬¸ì ë°œì†¡ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤" ì•Œë¦¼
  â†“
ê´€ë¦¬ìê°€ ë‹¤ì‹œ ì‹œë„ ê°€ëŠ¥
```

#### 2ï¸âƒ£ **ì˜¤ë˜ëœ ë°ì´í„° ìë™ ì‚­ì œ**

**ì‹¤í–‰ ì‹œê°„:** ë§¤ì¼ ìƒˆë²½ 2ì‹œ (í•œêµ­ ì‹œê°„)

**ìë™ ì‹¤í–‰:**
```
1. deleteAt < ì˜¤ëŠ˜ ì¡°ê±´ ê²€ìƒ‰
2. í•´ë‹¹ ë¬¸ì„œì˜ ì²¨ë¶€íŒŒì¼ ì‚­ì œ
3. Firestore ë¬¸ì„œ ì‚­ì œ
4. ë¡œê·¸ ê¸°ë¡
```

**ì‚­ì œ ê¸°ì¤€:**
- ë¬¸ì˜ ì ‘ìˆ˜ì¼ë¡œë¶€í„° **179ì¼ ê²½ê³¼**
- ê°œì¸ì •ë³´ë³´í˜¸ë²• ì¤€ìˆ˜ (180ì¼ ì´ë‚´ ì‚­ì œ)

#### 3ï¸âƒ£ **í† í° ìë™ ê°±ì‹ **

**íŠ¸ë¦¬ê±°:** Access Token ë§Œë£Œ (ì•½ 1ì‹œê°„)

**ìë™ ì‹¤í–‰:**
```
API í˜¸ì¶œ ì‹œ 401 Unauthorized ì‘ë‹µ
  â†“
í”„ë¡ íŠ¸ì—”ë“œê°€ ê°ì§€
  â†“
localStorageì—ì„œ í† í° ì‚­ì œ
  â†“
ë¡œê·¸ì¸ í™”ë©´ìœ¼ë¡œ ì´ë™
  â†“
ì‚¬ìš©ìê°€ ë‹¤ì‹œ ë¡œê·¸ì¸
```

---

## 8. ë¹„ìš© êµ¬ì¡°

### ğŸ’° ì›”ê°„ ì˜ˆìƒ ë¹„ìš©

| í•­ëª© | ì„œë¹„ìŠ¤ | ë¬´ë£Œ ë²”ìœ„ | ì‹¤ì œ ì‚¬ìš©ëŸ‰ | ì˜ˆìƒ ë¹„ìš© |
|------|--------|-----------|------------|----------|
| **í”„ë¡ íŠ¸ì—”ë“œ** | GitHub Pages | ì™„ì „ ë¬´ë£Œ | - | **â‚©0** |
| **GCP (ê³µê°œ API)** | Cloud Run | 200ë§Œ ìš”ì²­ | ì›” 1,000ê±´ | **â‚©0** |
| **GCP2 (ë°±ì—”ë“œ)** | Cloud Run | 200ë§Œ ìš”ì²­ | ì›” 5,000ê±´ | **â‚©0** |
| **GCP3 (SMS ì¤‘ê³„)** | Compute Engine (f1-micro) | í”„ë¦¬í‹°ì–´ | us-central1 | **â‚©0** |
| **Firestore** | ì½ê¸°/ì“°ê¸° | 5ë§Œ/2ë§Œ ê±´ | ì½ê¸° 3,000ê±´ | **â‚©0** |
| **Firebase Storage** | ì €ì¥/ë‹¤ìš´ë¡œë“œ | 5GB/1GB | 500MB/100MB | **â‚©0** |
| **GCP-cleanup** | Cloud Function | 200ë§Œ í˜¸ì¶œ | ì›” 30íšŒ | **â‚©0** |
| **Cloud Scheduler** | ìŠ¤ì¼€ì¤„ëŸ¬ | 3ê°œ ë¬´ë£Œ | 1ê°œ ì‚¬ìš© | **â‚©0** |
| **SMS ë°œì†¡** | Aligo | - | ê±´ë‹¹ ì•½ â‚©15 | **â‚©1,500** (100ê±´) |
| **ì´ê³„** | | | | **ì•½ â‚©1,500/ì›”** |

### ğŸ“Š ë¹„ìš© ìƒì„¸ ë¶„ì„

#### 1ï¸âƒ£ **ì™„ì „ ë¬´ë£Œ í•­ëª©**

- GitHub Pages (í˜¸ìŠ¤íŒ…)
- GCP í”„ë¦¬í‹°ì–´ (Cloud Run, Compute Engine)
- Firestore ë¬´ë£Œ í• ë‹¹ëŸ‰
- Firebase Storage ë¬´ë£Œ í• ë‹¹ëŸ‰
- Cloud Functions ë¬´ë£Œ í• ë‹¹ëŸ‰
- Cloud Scheduler (3ê°œê¹Œì§€ ë¬´ë£Œ)

#### 2ï¸âƒ£ **ìœ ì¼í•œ ìœ ë£Œ í•­ëª©: SMS**

**Aligo SMS ìš”ê¸ˆ:**
- ë‹¨ë¬¸ SMS (80ë°”ì´íŠ¸): ê±´ë‹¹ â‚©15
- ì¥ë¬¸ LMS (2,000ë°”ì´íŠ¸): ê±´ë‹¹ â‚©50

**ì˜ˆìƒ ì‚¬ìš©ëŸ‰:**
- ì›” 100ê±´ í™•ì¸ ë¬¸ì ë°œì†¡
- 100ê±´ Ã— â‚©15 = **â‚©1,500/ì›”**

#### 3ï¸âƒ£ **í™•ì¥ ì‹œ ë¹„ìš© ì¦ê°€ ì˜ˆìƒ**

**ìƒë‹´ ê±´ìˆ˜ê°€ ëŠ˜ì–´ë‚˜ë©´:**

| ì›” ìƒë‹´ ê±´ìˆ˜ | SMS ë¹„ìš© | GCP ë¹„ìš© | ì´ ë¹„ìš© |
|------------|---------|---------|---------|
| 100ê±´ | â‚©1,500 | â‚©0 | **â‚©1,500** |
| 500ê±´ | â‚©7,500 | â‚©0 | **â‚©7,500** |
| 1,000ê±´ | â‚©15,000 | â‚©500 | **â‚©15,500** |
| 5,000ê±´ | â‚©75,000 | â‚©3,000 | **â‚©78,000** |

**ì°¸ê³ :** ë¬´ë£Œ í• ë‹¹ëŸ‰ ì´ˆê³¼ ì‹œ GCP ë¹„ìš© ë°œìƒ ê°€ëŠ¥

---

## ğŸ“ ìš©ì–´ ì„¤ëª… (ë¹„ì „ê³µììš©)

### ê¸°ìˆ  ìš©ì–´

| ìš©ì–´ | ì‰¬ìš´ ì„¤ëª… |
|------|----------|
| **Frontend (í”„ë¡ íŠ¸ì—”ë“œ)** | ì‚¬ìš©ìê°€ ì§ì ‘ ë³´ê³  í´ë¦­í•˜ëŠ” í™”ë©´ ë¶€ë¶„ |
| **Backend (ë°±ì—”ë“œ)** | í™”ë©´ ë’¤ì—ì„œ ë°ì´í„°ë¥¼ ì²˜ë¦¬í•˜ëŠ” ì„œë²„ |
| **API** | í”„ë¡œê·¸ë¨ë¼ë¦¬ ëŒ€í™”í•˜ëŠ” í†µë¡œ (ìš°ì²´êµ­ ê°™ì€ ì—­í• ) |
| **OAuth** | ë‹¤ë¥¸ ì„œë¹„ìŠ¤ ê³„ì •(Google, Naver)ìœ¼ë¡œ ë¡œê·¸ì¸í•˜ëŠ” ë°©ì‹ |
| **Access Token** | ë¡œê·¸ì¸ ì¦ëª…ì„œ (ì¶œì…ì¦ ê°™ì€ ê²ƒ) |
| **Firestore** | Googleì´ ì œê³µí•˜ëŠ” ë°ì´í„° ì €ì¥ì†Œ (ì—‘ì…€ ê°™ì§€ë§Œ ìë™ ë™ê¸°í™”) |
| **Cloud Run** | í”„ë¡œê·¸ë¨ì„ ì¸í„°ë„·ì—ì„œ ì‹¤í–‰í•´ì£¼ëŠ” Google ì„œë¹„ìŠ¤ |
| **Cloud Function** | íŠ¹ì • ì‹œê°„ì— ìë™ ì‹¤í–‰ë˜ëŠ” ì‘ì€ í”„ë¡œê·¸ë¨ |
| **CORS** | íŠ¹ì • ì›¹ì‚¬ì´íŠ¸ë§Œ APIë¥¼ ì“¸ ìˆ˜ ìˆê²Œ ì œí•œí•˜ëŠ” ë³´ì•ˆ ê¸°ëŠ¥ |
| **reCAPTCHA** | "ì €ëŠ” ë¡œë´‡ì´ ì•„ë‹™ë‹ˆë‹¤" ì²´í¬ë°•ìŠ¤ (Google ì œê³µ) |

### ì¸ì¦/ë³´ì•ˆ ìš©ì–´

| ìš©ì–´ | ì‰¬ìš´ ì„¤ëª… |
|------|----------|
| **í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸** | í—ˆê°€ëœ ì‚¬ëŒ ëª©ë¡ (ëª…ë‹¨ì— ìˆì–´ì•¼ ì…ì¥ ê°€ëŠ¥) |
| **í† í° ê²€ì¦** | ì¶œì…ì¦ì´ ì§„ì§œì¸ì§€ í™•ì¸í•˜ëŠ” ê³¼ì • |
| **SSL/TLS** | ì¸í„°ë„· í†µì‹ ì„ ì•”í˜¸í™”í•´ì„œ ë„ì²­ ë°©ì§€ |
| **HTTPS** | ìë¬¼ì‡  í‘œì‹œê°€ ìˆëŠ” ì•ˆì „í•œ ì›¹ì‚¬ì´íŠ¸ ì£¼ì†Œ |
| **Rate Limiting** | ê°™ì€ ì‚¬ëŒì´ ë„ˆë¬´ ë§ì´ ìš”ì²­í•˜ë©´ ì°¨ë‹¨ |

---

## ğŸ“ ë¬¸ì˜ ë° ìœ ì§€ë³´ìˆ˜

### ì‹œìŠ¤í…œ ê´€ë¦¬ì ì—°ë½ì²˜

- **ê°œë°œì:** [ì´ë¦„]
- **ì´ë©”ì¼:** infra.steve.01@gmail.com
- **ë‹´ë‹¹ ì—…ë¬´:** ì‹œìŠ¤í…œ ì „ì²´ ê´€ë¦¬, ì¥ì•  ëŒ€ì‘

### ì£¼ìš” ê´€ë¦¬ ì‘ì—…

1. **í—ˆê°€ëœ ì´ë©”ì¼ ì¶”ê°€/ì‚­ì œ**
   - GCP2 í™˜ê²½ë³€ìˆ˜ ìˆ˜ì • í•„ìš”
   - ì¬ë°°í¬ ì—†ì´ ì¦‰ì‹œ ì ìš©

2. **SMS ë°œì†¡ ë²ˆí˜¸ ë³€ê²½**
   - GCP2 í™˜ê²½ë³€ìˆ˜ ìˆ˜ì •
   - Aligo ì„¤ì • í™•ì¸ í•„ìš”

3. **ë°ì´í„° ë°±ì—…**
   - Firestore Export ê¸°ëŠ¥ ì‚¬ìš©
   - ë§¤ì›” 1íšŒ ë°±ì—… ê¶Œì¥

4. **ë¡œê·¸ í™•ì¸**
   - GCP Consoleì—ì„œ Cloud Logging í™•ì¸
   - ì—ëŸ¬ ë°œìƒ ì‹œ ì•Œë¦¼ ì„¤ì • ê°€ëŠ¥

---

## ğŸ”§ íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### ìì£¼ ë°œìƒí•˜ëŠ” ë¬¸ì œ

#### 1ï¸âƒ£ **ë¡œê·¸ì¸ì´ ì•ˆ ë¼ìš”**

**ì›ì¸:**
- ì´ë©”ì¼ì´ í™”ì´íŠ¸ë¦¬ìŠ¤íŠ¸ì— ì—†ìŒ
- í† í° ë§Œë£Œ

**í•´ê²°:**
1. ì´ë©”ì¼ í™•ì¸ (admin@apsconsulting.kr ë“±)
2. ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ í›„ ì¬ë¡œê·¸ì¸
3. ê·¸ë˜ë„ ì•ˆ ë˜ë©´ ê´€ë¦¬ìì—ê²Œ ì—°ë½

#### 2ï¸âƒ£ **ë¬¸ìê°€ ì•ˆ ê°€ìš”**

**ì›ì¸:**
- GCP3 (SMS ì¤‘ê³„ ì„œë²„) ì˜¤ë¥˜
- Aligo API ì”ì•¡ ë¶€ì¡±
- ì „í™”ë²ˆí˜¸ í˜•ì‹ ì˜¤ë¥˜

**í•´ê²°:**
```bash
# 1. GCP3 ìƒíƒœ í™•ì¸
curl http://136.113.67.193:3000/health

# 2. ì„œë¹„ìŠ¤ ì¬ì‹œì‘
gcloud compute ssh aligo-proxy --zone=us-central1-a \
  --command="sudo systemctl restart sms-relay"

# 3. Aligo ì”ì•¡ í™•ì¸ (ì›¹ì‚¬ì´íŠ¸)
https://smartsms.aligo.in
```

#### 3ï¸âƒ£ **ë¬¸ì˜ê°€ ì•ˆ ë³´ì—¬ìš”**

**ì›ì¸:**
- API ì‘ë‹µ ì§€ì—°
- Firestore ì ‘ê·¼ ê¶Œí•œ ë¬¸ì œ

**í•´ê²°:**
1. ë¸Œë¼ìš°ì € ìƒˆë¡œê³ ì¹¨ (F5)
2. ë¡œê·¸ì•„ì›ƒ í›„ ì¬ë¡œê·¸ì¸
3. ê°œë°œì ë„êµ¬ Console í™•ì¸ (F12)

#### 4ï¸âƒ£ **ì²¨ë¶€íŒŒì¼ì´ ì•ˆ ì—´ë ¤ìš”**

**ì›ì¸:**
- ì„œëª…ëœ URL ë§Œë£Œ (1ì‹œê°„)
- íŒŒì¼ì´ Storageì—ì„œ ì‚­ì œë¨

**í•´ê²°:**
1. ëª¨ë‹¬ ë‹«ê³  ë‹¤ì‹œ ì—´ê¸° (ìƒˆ URL ë°œê¸‰)
2. íŒŒì¼ì´ ì •ë§ ì—†ë‹¤ë©´ ë³µêµ¬ ë¶ˆê°€

---

## ğŸ“š ì¶”ê°€ ìë£Œ

### ê³µì‹ ë¬¸ì„œ

- [Google Cloud Run ë¬¸ì„œ](https://cloud.google.com/run/docs)
- [Firestore ë¬¸ì„œ](https://firebase.google.com/docs/firestore)
- [Firebase Storage ë¬¸ì„œ](https://firebase.google.com/docs/storage)
- [Aligo SMS API ë¬¸ì„œ](https://smartsms.aligo.in/admin/api/spec.html)

### ê´€ë ¨ íŒŒì¼

- `CLAUDE.md` - ê°œë°œ ê°€ì´ë“œ (ê°œë°œììš©)
- `MIGRATION_SUMMARY.md` - ì‹œìŠ¤í…œ ë§ˆì´ê·¸ë ˆì´ì…˜ ì´ë ¥
- `GCP2/README.md` - ë°±ì—”ë“œ API ì„¤ëª…ì„œ
- `GCP3/README.md` - SMS ì¤‘ê³„ ì„œë²„ ì„¤ëª…ì„œ
- `GCP-cleanup/README.md` - ìë™ ì‚­ì œ ì‹œìŠ¤í…œ ì„¤ëª…ì„œ

---

**ì‘ì„±ì¼:** 2024-12-08
**ë²„ì „:** 1.0
**ì‘ì„±ì:** Claude (AI Assistant)

ì´ ë¬¸ì„œëŠ” ì‹œìŠ¤í…œ ë³€ê²½ ì‹œ í•¨ê»˜ ì—…ë°ì´íŠ¸ë˜ì–´ì•¼ í•©ë‹ˆë‹¤.
